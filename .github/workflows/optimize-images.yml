# .github/workflows/optimize-images.yml
name: ðŸ“· Optimize & Resize Images

on:
  push:
    paths:
      - 'season*/**/*.jpg'
      - 'season*/**/*.jpeg'
      - 'season*/**/*.png'
      - 'season*/**/*.webp'
      - '.github/workflows/optimize-images.yml'

permissions:
  contents: write  # Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ñ‚ÑŒ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹

jobs:
  optimize:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Resize oversized images
      uses: petems/image-resizer-gh-action@master
      with:
        target: '.'
        widthLimit: 1920
        heightLimit: 1080

    - name: Compress images (Calibre)
      id: calibre
      uses: calibreapp/image-actions@main
      with:
        githubToken: ${{ secrets.GITHUB_TOKEN }}
        compressOnly: true    # <â€” Ð²Ð°Ð¶Ð½Ñ‹Ð¹ Ñ„Ð»Ð°Ð³ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð½Ð° push

    - name: Debug
      run: |
        git status
        git diff --name-only

    - name: Commit optimized images
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: '[ci skip] optimize & resize images'
        file_pattern: |
            **/season*/**/*.{jpg,jpeg,png,webp}
