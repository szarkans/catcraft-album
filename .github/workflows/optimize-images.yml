# .github/workflows/optimize-images.yml
name: üì∑ Optimize & Resize Images

on:
  push:
    branches: [main]

permissions:
  contents: write   # —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

jobs:
  optimize:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0           # –∑–∞–±–∏—Ä–∞–µ–º –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é
          persist-credentials: true  # —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –ø—É—à–∞

      - name: Resize images >1920√ó1080
        id: resize
        uses: petems/image-resizer-gh-action@master
        with:
          target: 'season*'         # –ø–∞–ø–∫–∏-—Å–µ–∑–æ–Ω—ã –≤ –∫–æ—Ä–Ω–µ
          widthLimit: 1920          # –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞
          heightLimit: 1080         # –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞

      - name: Compress images
        uses: calibreapp/image-actions@main
        with:
          githubToken: ${{ secrets.GITHUB_TOKEN }}
          # –º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∑–∞–¥–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ:
          # jpeg:
          #   quality: '80'
          # png:
          #   quality: '80-90'
          # webp:
          #   quality: '80'

      - name: Commit and push optimized images
        uses: EndBug/add-and-commit@v4
        with:
          add: 'season*/**/*.{jpg,jpeg,png,webp}'
          message: '[ci skip] optimize & resize images'
  